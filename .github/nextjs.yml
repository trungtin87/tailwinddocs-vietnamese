# .github/workflows/deploy.yml

name: ğŸš€ Deploy Next.js Static Site to GitHub Pages

on:
  # KÃ­ch hoáº¡t khi cÃ³ push vÃ o nhÃ¡nh chÃ­nh (thay 'main' náº¿u cáº§n)
  push:
    branches:
      - main 
  # Cho phÃ©p cháº¡y thá»§ cÃ´ng
  workflow_dispatch:

# Quyá»n cáº§n thiáº¿t Ä‘á»ƒ action peaceiris/actions-gh-pages cÃ³ thá»ƒ push lÃªn repo
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4
        
      # --- Cáº¥u hÃ¬nh MÃ´i trÆ°á»ng ---
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # NÃªn dÃ¹ng phiÃªn báº£n LTS á»•n Ä‘á»‹nh
          cache: 'npm' # KÃ­ch hoáº¡t cache Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ cÃ i Ä‘áº·t

      - name: Install dependencies
        run: npm install

      # --- BÆ¯á»šC BUILD VÃ€ EXPORT ---
      # NEXT_PUBLIC_BASE_PATH sáº½ Ä‘Æ°á»£c truyá»n vÃ o next.config.js Ä‘á»ƒ cáº¥u hÃ¬nh basePath
      - name: Static Export Next.js
        run: |
          # Láº¥y tÃªn repository (vÃ­ dá»¥: my-next-app)
          REPO_NAME=${{ github.event.repository.name }}
          
          # Thiáº¿t láº­p BASE_PATH (vÃ­ dá»¥: /my-next-app)
          export NEXT_PUBLIC_BASE_PATH=/${REPO_NAME}
          
          # Cháº¡y lá»‡nh build (lá»‡nh nÃ y sáº½ táº¡o ra thÆ° má»¥c 'out')
          npm run build
        
      # --- BÆ¯á»šC DEPLOY ---
      - name: Deploy to GitHub Pages ğŸš€
        id: deployment
        uses: peaceiris/actions-gh-pages@v4
        with:
          # Token máº·c Ä‘á»‹nh cá»§a GitHub
          github_token: ${{ secrets.GITHUB_TOKEN }} 
          # ThÆ° má»¥c chá»©a cÃ¡c file static Next.js Ä‘Ã£ xuáº¥t
          publish_dir: ./out 
          # NhÃ¡nh sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ host trang web
          publish_branch: gh-pages 
          # Giá»¯ láº¡i lá»‹ch sá»­ commit cá»§a nhÃ¡nh gh-pages
          keep_files: false
          # Cho phÃ©p commit trá»‘ng
          allow_empty_commit: true
